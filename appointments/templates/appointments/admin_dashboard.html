{% extends 'appointments/base.html' %}

{% block content %}
<div style="max-width: 1400px; margin: 0 auto; padding: 20px;">
    
    <div style="background: linear-gradient(135deg, #0052cc 0%, #2b82ff 100%); border-radius: 20px; padding: 40px; color: white; margin-bottom: 30px; box-shadow: 0 10px 20px rgba(0, 82, 204, 0.1);">
        <h1 style="margin: 0; font-size: 2.2rem;">Good Day, {{ user.username|capfirst }}!</h1>
        <p style="opacity: 0.9; margin-top: 5px;">Clinic Overview & Recent Activity</p>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 25px;">
        <div style="background: white; padding: 25px; border-radius: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); display: flex; align-items: center; gap: 20px;">
            <div style="background: #e6f0ff; color: #0052cc; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">.</div>
            <div>
                <h3 style="margin: 0; font-size: 1.8rem;">{{ stats.total_patients }}</h3>
                <p style="margin: 0; color: #888; font-size: 0.9rem;">Registered Patients</p>
            </div>
        </div>
        <div style="background: white; padding: 25px; border-radius: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); display: flex; align-items: center; gap: 20px;">
            <div style="background: #fff7ed; color: #f97316; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">.</div>
            <div>
                <h2 style="margin: 0; font-size: 1.8rem;">₱{{ stats.earnings|floatformat:2 }}</h2>
                <p style="margin: 0; color: #64748b; font-size: 0.8rem;">Earnings (Completed)</p>
            </div>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 40px;">
        <div style="background: white; padding: 20px; border-radius: 15px; text-align: center; border-bottom: 4px solid #0052cc; box-shadow: 0 4px 15px rgba(0,0,0,0.03);">
            <h4 style="margin: 0; color: #0052cc; font-size: 1.5rem;">{{ stats.pending }}</h4>
            <p style="color: #666; font-size: 0.8rem; text-transform: uppercase; margin-top: 5px;">Pending</p>
        </div>
        <div style="background: white; padding: 20px; border-radius: 15px; text-align: center; border-bottom: 4px solid #2ecc71; box-shadow: 0 4px 15px rgba(0,0,0,0.03);">
            <h4 style="margin: 0; color: #2ecc71; font-size: 1.5rem;">{{ stats.admitted }}</h4>
            <p style="color: #666; font-size: 0.8rem; text-transform: uppercase; margin-top: 5px;">Admitted</p>
        </div>
        <div style="background: white; padding: 20px; border-radius: 15px; text-align: center; border-bottom: 4px solid #f1c40f; box-shadow: 0 4px 15px rgba(0,0,0,0.03);">
            <h4 style="margin: 0; color: #f1c40f; font-size: 1.5rem;">{{ stats.discharged }}</h4>
            <p style="color: #666; font-size: 0.8rem; text-transform: uppercase; margin-top: 5px;">Discharged</p>
        </div>
    </div>

    <div style="background: white; border-radius: 20px; padding: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.05);">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
            <h3 style="margin: 0; color: #1e293b; font-size: 1.3rem;">Completed Appointments (Paid)</h3>
            <a href="{% url 'all_appointments' %}" style="color: #0052cc; font-size: 0.85rem; text-decoration: none; font-weight: 600;">View All →</a>
        </div>

        <div style="max-height: 400px; overflow-y: auto; scrollbar-width: thin;">
            <table style="width: 100%; border-collapse: collapse; text-align: left;">
                <thead>
                    <tr style="border-bottom: 2px solid #f1f5f9;">
                        <th style="padding: 12px; color: #64748b; font-size: 0.75rem; text-transform: uppercase;">Patient</th>
                        <th style="padding: 12px; color: #64748b; font-size: 0.75rem; text-transform: uppercase;">Service</th>
                        <th style="padding: 12px; color: #64748b; font-size: 0.75rem; text-transform: uppercase;">Date</th>
                        <th style="padding: 12px; color: #64748b; font-size: 0.75rem; text-transform: uppercase;">Earnings</th>
                    </tr>
                </thead>
                <tbody>
                    {% for appt in appointments %}
                        {% if appt.status == 'completed' or appt.status == 'discharged' %}
                        <tr style="border-bottom: 1px solid #f1f5f9;">
                            <td style="padding: 15px; font-weight: 600; color: #1e293b;">{{ appt.patient_name }}</td>
                            <td style="padding: 15px; color: #64748b; font-size: 0.9rem;">{{ appt.get_service_type_display }}</td>
                            <td style="padding: 15px; color: #64748b; font-size: 0.9rem;">{{ appt.date|date:"M d, Y" }}</td>
                            <td style="padding: 15px; font-weight: 700; color: #2ecc71;">₱{{ appt.fee|floatformat:2 }}</td>
                        </tr>
                        {% endif %}
                    {% empty %}
                        <tr>
                            <td colspan="4" style="padding: 30px; text-align: center; color: #94a3b8;">No completed appointments yet.</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<style>
    /* Custom Scrollbar */
    div::-webkit-scrollbar { width: 6px; }
    div::-webkit-scrollbar-track { background: #f1f5f9; }
    div::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
</style>
{% endblock %}